# EscapeChan

Движок имиджборды, написанный на Go.

## Предупреждение

Инструкция предполагает, что вы обладаете достаточными навыками системного администрирования и понимаете риски выполняемых команд (в частности, `chmod -R 0777` даёт полные права на запись всем пользователям). Рекомендуется использовать выделенный сервер или виртуальную машину.

## Требования

- ОС Ubuntu (рекомендуется последняя LTS-версия)
- Доступ root
- Установленные Nginx, MySQL и PHP-FPM (рекомендуется PHP 8.4)  
  Можно воспользоваться готовым автоинсталлятором LEMP у вашего VPS-провайдера

## Установка и настройка

1. **Установка зависимостей**  
   Установите Nginx, MySQL и PHP-FPM.  
   Если используете автоинсталлятор LEMP — пропустите ручную установку.

2. **Установка Go**  
   Следуйте официальной инструкции на сайте [golang.org](https://golang.org/dl/).

3. **Размещение файлов проекта**  
   Выгрузите содержимое репозитория в директорию `/home/escapechan`.

4. **Права доступа**  
   ```bash
   chmod -R 0777 /home/escapechan

5. **Настройка Nginx**  
   - Скопируйте файл `nginx_default_site_config` в `/etc/nginx/sites-enabled/`.
   - Удалите все остальные файлы и символические ссылки из `/etc/nginx/sites-enabled/`.
   - Если у вас версия PHP-FPM отличается от 8.4, отредактируйте строку в конфигурации:  
     ```
     fastcgi_pass unix:/run/php/php8.4-fpm.sock;
     ```
     заменив `8.4` на вашу версию.
   - Перезапустите Nginx:  
     ```bash
     service nginx restart
     ```

6. **Настройка базы данных**  
   - Создайте базу данных MySQL.
   - Импортируйте структуру из файла `database.sql`.

7. **Сборка бэкенда**  
   ```bash
   cd /home/escapechan/src/go && go build -o bin/backend && cp /home/escapechan/src/go/bin/backend /home/escapechan/main/backend
   ```

8. **Запуск основного бэкенда**  
   ```bash
   nohup /home/escapechan/main/backend > /dev/null & echo $!
   ```

9. **Запуск микросервиса генерации локальных ID постов**  
   Без него посты не будут отправляться.  
   ```bash
   nohup /home/escapechan/nums/nums > /dev/null & echo $!
   ```

## Доступ к модераторской панели

- URL: `http://ваш_домен/moder/`
- Логин: `admin`
- Пароль: `admin`

**Важно:** После создания новой доски в модераторской панели она появится на сайте в течение минуты (главные страницы досок обновляются раз в минуту).

## Структура директорий

- `root/` — HTML- и JSON-файлы тредов, символические ссылки на прикреплённые изображения и видео.
- `media/` — оригинальные файлы загруженных изображений и видео.

## Поддержка и обратная связь

Если возникнут вопросы — создавайте Issue в этом репозитории.