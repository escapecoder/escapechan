# Escapechan

Движок имиджборды, написанный на Go.

## Предупреждение

Инструкция пишется с расчётом на то, что на сервере установлена ОС Ubuntu и что всё содержимое репозитория будет размещено в директории ```/home/escapechan```. Также, предполагается, что все действия выполняются от имени root-пользователя, и что у пользователя имеются навыки программирования и системного администрирования.

## Порядок установки и настройки

**1**. Установите Nginx, MySQL и PHP-FPM, либо воспользуйтесь автоинсталлятором LEMP, имеющимся у многих VPS-сервисов;

**2**. Установите пакет Go по официальной инструкции на сайте [golang.org](https://golang.org/dl/);

**3**. После выгрузки содержимого репозитория на сервер выполните команду **chmod -R 0777 /home/escapechan**, чтобы все директории стали доступны для записи;

**4**. Разместите файл **nginx_default_site_config** в директории **/etc/nginx/sites-enabled**, удалив из неё другие файлы и симлинки;

**5**. Если на сервере установлена версия PHP-FPM, отличная от 8.4, следует прописать эту версию в строке ```fastcgi_pass unix:/run/php/php8.4-fpm.sock;```

**6**. Выполните команду ```service nginx restart```;

**7**. Настройте базу данных MySQL и загрузите дамп структуры из файла **database.sql**;

**8**. Для обработки аудио- и видеофайлов установите пакет **ffmpeg**:

```
sudo apt-get install ffmpeg
```

**9**. Соберите бинарник из исходников следующей командой:

```
cd /home/escapechan/src/go && go build -o bin/backend && cp /home/escapechan/src/go/bin/backend /home/escapechan/main/backend
```

**10**. Запустите бинарник:

```
nohup /home/escapechan/main/backend > /dev/null & echo $!
```

**11**. После этого запустите микросервис генерации локальных ID постов в пределах досок на борде, иначе посты не будут отправляться:

```nohup /home/escapechan/nums/nums > /dev/null & echo $!```

## Дополнительно

Для входа в модерку используйте URL: ```http://ваш_домен/moder/```, а также логин и пароль **admin**. Имейте в виду, что после создания новой доски в модерке она появляется на сайте в течение минуты (главные страницы досок перерисовываются раз в минуту).

В директории **root** хранятся HTML- и JSON-файлы тредов, а также симлинки приложенных к постам картинок и видео, оригинальные файлы которых хранятся в директории **media**.