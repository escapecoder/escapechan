server {
	listen 80 default_server;

	server_name site.ru;
	
	root /home/escapechan/root;
	
	client_max_body_size 100m;
	absolute_redirect off;
	server_tokens off;
	
	error_page 400 403 404 410 =404 /notfound.html;
	error_page 418 =403 /rkn.html;
	
	access_log  /dev/null;
	
    location / {
		add_header Last-Modified "";
		
		try_files $uri $uri/ /fallback$uri;
	}
	
    location /robots.txt {
		auth_request off;
	}
	
	include /home/escapechan/main/nginx_disable_media_location.conf;
	
    location /favicon.ico {
		auth_basic off;
	}
	
    location /api {
		proxy_pass http://127.0.0.1:8999/api;
		proxy_http_version 1.1;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $remote_addr;
		proxy_set_header X-Forwarded-Host $remote_addr;
    }
	
    location /user {
		proxy_pass http://127.0.0.1:8999/user;
		proxy_http_version 1.1;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $remote_addr;
		proxy_set_header X-Forwarded-Host $remote_addr;
    }
	
    location /moder {
		proxy_pass http://127.0.0.1:8999/moder;
		proxy_http_version 1.1;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $remote_addr;
		proxy_set_header X-Forwarded-Host $remote_addr;
    }
	
    location /fallback {
		proxy_pass http://127.0.0.1:8999/fallback;
		proxy_http_version 1.1;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $remote_addr;
		proxy_set_header X-Forwarded-Host $remote_addr;
    }
	
	location ~ \.php$ {
		try_files $uri =404;
		fastcgi_index index.php;
		fastcgi_pass unix:/run/php/php8.2-fpm.sock;
		fastcgi_split_path_info ^((?U).+\.ph(?:p\d*|tml))(/?.+)$;
		include fastcgi.conf;
	}
	
    location /media/ {
		root /home/escapechan/;
    }
}
